<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tracker</title>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <style>
      #fields {
          display: flex;
          flex-direction: column;
          font-size: 1rem;
      }

      .field {
          display: flex;
          flex-direction: row;
          align-items: center;
          justify-content: space-between;
          margin-bottom: 0.5rem;
          padding: 0.5rem;
          gap: 1rem;
          height: 48px;
      }

      .field:nth-of-type(odd) {
          background-color: #eee;
      }

      input[type=checkbox] {
          width: 1.5rem;
          height: 1.5rem;
      }

      button#submitButton {
          font-size: 1rem;
          margin: auto;
          display: inline-block;
          width: 100%;
          padding: 10px;
          height: 48px;
      }
  </style>
</head>

<body>
<form id="dataForm" onsubmit="return false">
  <label for="date">Date:</label>
  <input type="datetime-local" id="date" name="date" value="" data-column="date"><br>

  <label for="energy">Energy:</label>
  <input type="range" id="energy" name="energy" min="0" max="10" value="5" data-column="energy"><br>
  <fieldset>
    <legend>Sleep</legend>
    <label for="went_to_bed">Went to bed:</label>
    <input type="time" id="went_to_bed" name="went_to_bed" value="23:00" data-column="went_to_bed"><br>

    <label for="woke_up">Woke up:</label>
    <input type="time" id="woke_up" name="woke_up" value="07:00" data-column="woke_up"><br>

    <label for="snooze">Snooze:</label>
    <input type="checkbox" id="snooze" name="snooze" data-column="snooze"><br>

    <label for="woke_up_mid_night">Woke up mid night:</label>
    <input type="checkbox" id="woke_up_mid_night" name="woke_up_mid_night" data-column="woke_up_mid_night"><br>
  </fieldset>

  <fieldset>
    <legend>Consumption</legend>
    <label for="last_eat">Last eat:</label>
    <input type="time" id="last_eat" name="last_eat" value="20:00" data-column="last_eat"><br>

    <label for="last_coffee">Last coffee:</label>
    <input type="time" id="last_coffee" name="last_coffee" value="14:00" data-column="last_coffee"><br>

    <label for="last_water">Last water:</label>
    <input type="time" id="last_water" name="last_water" value="20:00" data-column="last_water"><br>

    <label for="alcohol">Alcohol:</label>
    <input type="checkbox" id="alcohol" name="alcohol" data-column="alcohol"><br>

    <label for="keto">Keto:</label>
    <input type="checkbox" id="keto" name="keto" data-column="keto"><br>

    <label for="stuffed">Feeling bloated:</label>
    <input type="checkbox" id="stuffed" name="stuffed" data-column="stuffed"><br>
  </fieldset>

  <fieldset>
    <legend>Activities (Hours)</legend>
    <label for="productivity">Productivity:</label>
    <input type="number" id="productivity" name="productivity" value="0" data-column="productivity"><br>

    <label for="family">Family:</label>
    <input type="number" id="family" name="family" value="0" data-column="family"><br>

    <label for="social">Social:</label>
    <input type="number" id="social" name="social" value="0" data-column="social"><br>

    <label for="creative">Creative:</label>
    <input type="number" id="creative" name="creative" value="0" data-column="creative"><br>
  </fieldset>

  <fieldset>
    <legend>Well-being</legend>

    <label for="shower">Last Shower:</label>
    <input type="time" id="shower" name="shower" value="20:00" data-column="shower"><br>
    
    <label for="work_late">Work late?:</label>
    <input type="checkbox" id="work_late" name="work_late" data-column="work_late"><br>

    <label for="sick">Sick:</label>
    <input type="checkbox" id="sick" name="sick" data-column="sick"><br>
    
    <label for="porn">Porn:</label>
    <input type="checkbox" id="porn" name="porn" data-column="porn"><br>
  </fieldset>

  <button id="submitButton">SUBMIT</button>
</form>
</body>

<script>
  const supabaseClient = supabase.createClient('https://otlkqlgtytznkoyznznn.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im90bGtxbGd0eXR6bmtveXpuem5uIiwicm9sZSI6ImFub24iLCJpYXQiOjE2OTQzMzYwMjAsImV4cCI6MjAwOTkxMjAyMH0.02v7rS-lI7vgn0q_Fr5y9Av-1tuw-k-TWviJkQpNGhU');
  
  function handleSubmit(event) {
    const inputs = document.querySelectorAll("input");
    
    const data = {};
    console.log(inputs);
    for (const input of Array.from(inputs)) {
      data[input.getAttribute("data-column")] = input.type === 'checkbox'
        ? input.checked
        : input.value;
    }
    
    console.log(data);
    
    supabaseClient
      .from('tracker')
      .insert([data])
      .then((res) => {
        if (res?.error?.code) {
          console.error(res.error);
          alert("Error!");
          return;
        }

        console.info("Success!");
        alert("Success!");
      })
      .catch((err) => {
        console.error(err);
        alert("Error!");
      });
  }
  
  const submitButton = document.querySelector("#submitButton");
  submitButton.addEventListener("click", handleSubmit);
</script>
<script>
  const getIsoFormat = () => {
    const timezoneOffset = (new Date()).getTimezoneOffset() * 60000; //offset in milliseconds
    const localISOTime = (new Date(Date.now() - timezoneOffset)).toISOString().slice(0, -1);
    return localISOTime.slice(0, 16);
  };
  
  const dateInput = document.querySelector("input[type=datetime-local]");
  dateInput.value = getIsoFormat();
</script>
</html>
